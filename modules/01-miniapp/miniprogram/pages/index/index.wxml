<!-- pages/index/index.wxml -->
<view class="page">
  <view class="header">
    <view class="brand">
      <text class="brand-title">{{appName}}</text>
      <text class="brand-subtitle">学习训练与测评辅助</text>
    </view>

    <view class="profile" wx:if="{{userInfo.avatarUrl}}" bindtap="gocenter">
      <image class="avatar" src="{{userInfo.avatarUrl}}"></image>
      <view class="profile-text">
        <view class="profile-name">{{userInfo.realname || userInfo.nickName || '同学'}}</view>
        <view class="profile-meta" wx:if="{{userInfo.department}}">{{userInfo.department}}</view>
        <view class="profile-meta" wx:else>点击进入个人中心</view>
      </view>
      <view class="chevron">›</view>
    </view>

    <view class="profile guest" wx:else bindtap="login">
      <image class="avatar" src="/images/header.png"></image>
      <view class="profile-text">
        <view class="profile-name">点击登录</view>
        <view class="profile-meta">登录后可记录成绩与错题</view>
      </view>
      <view class="chevron">›</view>
    </view>
  </view>

  <view class="content">
    <view class="section-title">快捷功能</view>

    <view class="grid">
      <view class="card" bindtap="goLearn">
        <image class="card-icon" src="/images/icon_zhangjielianxi@3x.png"></image>
        <view class="card-title">练习</view>
        <view class="card-desc" wx:if="{{useLearn}}">章节/随机练习</view>
        <view class="card-desc disabled" wx:else>暂未开启</view>
      </view>

      <view class="card" bindtap="goExam">
        <image class="card-icon" src="/images/icon_monikaoshi@3x.png"></image>
        <view class="card-title">答题</view>
        <view class="card-desc">开始一次测评</view>
      </view>

      <view class="card" bindtap="goWrong">
        <image class="card-icon" src="/images/icon_cuotishoucang@3x.png"></image>
        <view class="card-title">错题</view>
        <view class="card-desc">针对复习巩固</view>
      </view>

      <view class="card" bindtap="goRank">
        <image class="card-icon" src="/images/icon_monichnegji@3x.png"></image>
        <view class="card-title">排名</view>
        <view class="card-desc">查看成绩排行</view>
      </view>
    </view>
  </view>

  <view class="content">
    <view class="section-title">首页商业位（配置驱动）</view>

    <swiper class="biz-swiper" indicator-dots autoplay interval="3500" duration="300" circular>
      <swiper-item wx:for="{{homeConfig.banners}}" wx:key="id">
        <view
          class="biz-banner"
          bindtap="onBizTap"
          data-type="{{item.action.type}}"
          data-url="{{item.action.url}}"
          data-text="{{item.action.text}}"
        >
          <view class="biz-banner-title">{{item.title}}</view>
          <view class="biz-banner-desc">{{item.subtitle}}</view>
        </view>
      </swiper-item>
    </swiper>

    <view class="convert">
      <view
        class="convert-card"
        bindtap="onBizTap"
        data-type="{{homeConfig.conversion.svip.action.type}}"
        data-url="{{homeConfig.conversion.svip.action.url}}"
        data-text="{{homeConfig.conversion.svip.action.text}}"
      >
        <view class="convert-title">{{homeConfig.conversion.svip.title}}</view>
        <view class="convert-desc">{{svipBound ? '已开通（本地 Mock）' : homeConfig.conversion.svip.desc}}</view>
        <view class="convert-tag">{{svipBound ? '已绑定' : '去绑定'}}</view>
      </view>

      <view
        class="convert-card alt"
        bindtap="onBizTap"
        data-type="{{homeConfig.conversion.pay.action.type}}"
        data-url="{{homeConfig.conversion.pay.action.url}}"
        data-text="{{homeConfig.conversion.pay.action.text}}"
      >
        <view class="convert-title">{{homeConfig.conversion.pay.title}}</view>
        <view class="convert-desc">{{homeConfig.conversion.pay.desc}}</view>
        <view class="convert-tag">了解</view>
      </view>
    </view>

    <view class="sub-title">推荐课程</view>
    <scroll-view class="h-scroll" scroll-x>
      <view class="h-list">
        <view
          class="h-card"
          wx:for="{{homeConfig.recommend.courses}}"
          wx:key="id"
          bindtap="onBizTap"
          data-type="{{item.action.type}}"
          data-url="{{item.action.url}}"
          data-text="{{item.action.text}}"
        >
          <view class="h-title">{{item.title}}</view>
          <view class="h-desc">{{item.desc}}</view>
          <view class="h-meta">
            <text class="pill">{{item.durationText}}</text>
            <text class="pill price {{item.vip ? 'vip' : ''}}">{{item.price}}</text>
          </view>
        </view>
      </view>
    </scroll-view>

    <view class="sub-title">推荐题库</view>
    <view class="list">
      <view
        class="mini-card"
        wx:for="{{homeConfig.recommend.banks}}"
        wx:key="id"
        bindtap="onBizTap"
        data-type="{{item.action.type}}"
        data-url="{{item.action.url}}"
        data-text="{{item.action.text}}"
      >
        <view class="mini-left">
          <view class="mini-title">{{item.title}}</view>
          <view class="mini-meta">{{item.tag}}</view>
        </view>
        <view class="mini-right">
          <view class="mini-price {{item.vip ? 'vip' : ''}}">{{item.price}}</view>
          <view class="mini-go">进入</view>
        </view>
      </view>
    </view>
  </view>

  <view class="warrant" wx:if="{{!is_login}}">
    <view class="white">
      <view class="tap">您还未登录</view>
      <view class="tip">请先登录再进行操作</view>
      <view class="pictrue"></view>
      <view class="actions">
        <button class="no" type="primary" bindtap="login" lang="zh_CN">暂不登录</button>
        <button wx:if="{{canIUseGetUserProfile}}" class="but" bindtap="getUserProfile">立即登录</button>
        <button wx:else class="but" type="primary" open-type="getUserInfo" lang="zh_CN" bindgetuserinfo="bindgetuserinfo">立即登录</button>
      </view>
    </view>
    <view class="mask"></view>
  </view>
</view>

