<!-- pages/index/index.wxml -->
<view class="page">
  <view class="header">
    <view class="brand">
      <text class="brand-title">{{appName}}</text>
      <text class="brand-subtitle">学习训练与测评辅助</text>
    </view>

    <view class="profile" wx:if="{{userInfo.avatarUrl}}" bindtap="gocenter">
      <image class="avatar" src="{{userInfo.avatarUrl}}"></image>
      <view class="profile-text">
        <view class="profile-name">{{userInfo.realname || userInfo.nickName || '同学'}}</view>
        <view class="profile-meta" wx:if="{{userInfo.department}}">{{userInfo.department}}</view>
        <view class="profile-meta" wx:else>点击进入个人中心</view>
      </view>
      <view class="chevron">›</view>
    </view>

    <view class="profile guest" wx:else bindtap="login">
      <image class="avatar" src="/images/header.png"></image>
      <view class="profile-text">
        <view class="profile-name">点击登录</view>
        <view class="profile-meta">登录后可记录成绩与错题</view>
      </view>
      <view class="chevron">›</view>
    </view>
  </view>

  <view class="content">
    <swiper
      class="banner-swiper"
      wx:if="{{banners.length}}"
      indicator-dots="true"
      autoplay="true"
      interval="4000"
      duration="500"
      circular="true"
    >
      <swiper-item wx:for="{{banners}}" wx:key="id">
        <view class="banner" data-action="{{item.action}}" bindtap="handleAction">
          <image class="banner-img" src="{{item.image}}" mode="aspectFill"></image>
          <view class="banner-mask"></view>
          <view class="banner-title">{{item.title}}</view>
        </view>
      </swiper-item>
    </swiper>

    <view class="stage">
      <view class="stage-label">学段</view>
      <view class="stage-chips">
        <view
          class="stage-chip {{stage === item ? 'active' : ''}}"
          wx:for="{{stageList}}"
          wx:key="*this"
          data-stage="{{item}}"
          bindtap="switchStage"
        >
          {{item}}
        </view>
      </view>
    </view>

    <view class="conversion" wx:if="{{!svipBound && conversion.svipBind}}">
      <view class="conversion-card primary" data-action="{{conversion.svipBind.action}}" bindtap="handleAction">
        <view class="conversion-title">{{conversion.svipBind.title}}</view>
        <view class="conversion-desc">{{conversion.svipBind.desc}}</view>
      </view>
      <view class="conversion-card" wx:if="{{conversion.svipOpen}}" data-action="{{conversion.svipOpen.action}}" bindtap="handleAction">
        <view class="conversion-title">{{conversion.svipOpen.title}}</view>
        <view class="conversion-desc">{{conversion.svipOpen.desc}}</view>
      </view>
    </view>
    <view class="conversion" wx:else>
      <view class="conversion-card bound">
        <view class="conversion-title">SVIP 已绑定</view>
        <view class="conversion-desc">可进入课程与题库体验完整能力</view>
      </view>
    </view>

    <view class="section-title">快捷功能</view>

    <view class="grid">
      <view class="card" bindtap="goLearn">
        <image class="card-icon" src="/images/icon_zhangjielianxi@3x.png"></image>
        <view class="card-title">练习</view>
        <view class="card-desc" wx:if="{{useLearn}}">章节/随机练习</view>
        <view class="card-desc disabled" wx:else>暂未开启</view>
      </view>

      <view class="card" bindtap="goExam">
        <image class="card-icon" src="/images/icon_monikaoshi@3x.png"></image>
        <view class="card-title">答题</view>
        <view class="card-desc">开始一次测评</view>
      </view>

      <view class="card" bindtap="goWrong">
        <image class="card-icon" src="/images/icon_cuotishoucang@3x.png"></image>
        <view class="card-title">错题</view>
        <view class="card-desc">针对复习巩固</view>
      </view>

      <view class="card" bindtap="goRank">
        <image class="card-icon" src="/images/icon_monichnegji@3x.png"></image>
        <view class="card-title">排名</view>
        <view class="card-desc">查看成绩排行</view>
      </view>

      <view class="card" bindtap="goCourse">
        <image class="card-icon" src="/images/icon_center_msg.png"></image>
        <view class="card-title">课程</view>
        <view class="card-desc">精选视频课程</view>
      </view>
    </view>

    <view class="section-title">推荐课程</view>
    <scroll-view class="h-list" scroll-x="true" show-scrollbar="false">
      <view class="h-list-inner">
        <view class="h-item" wx:for="{{recommend.courses}}" wx:key="id" data-action="{{item.action}}" bindtap="handleAction">
          <image class="h-cover" src="{{item.cover}}" mode="aspectFill"></image>
          <view class="h-title">{{item.title}}</view>
          <view class="h-subtitle">{{item.subtitle}}</view>
          <view class="h-meta">
            <text class="badge" wx:if="{{item.badge}}">{{item.badge}}</text>
            <text class="price" wx:if="{{item.price}}">{{item.price}}</text>
          </view>
        </view>
      </view>
    </scroll-view>

    <view class="section-title">推荐题库</view>
    <view class="v-list">
      <view class="v-item" wx:for="{{recommend.banks}}" wx:key="id" data-action="{{item.action}}" bindtap="handleAction">
        <view class="v-body">
          <view class="v-title">
            <text>{{item.title}}</text>
            <text class="badge" wx:if="{{item.badge}}">{{item.badge}}</text>
          </view>
          <view class="v-subtitle">{{item.subtitle}}</view>
        </view>
        <view class="chevron">›</view>
      </view>
    </view>
  </view>

  <view class="warrant" wx:if="{{!is_login}}">
    <view class="white">
      <view class="tap">您还未登录</view>
      <view class="tip">请先登录再进行操作</view>
      <view class="pictrue"></view>
      <view class="actions">
        <button class="no" type="primary" bindtap="login" lang="zh_CN">暂不登录</button>
        <button wx:if="{{canIUseGetUserProfile}}" class="but" bindtap="getUserProfile">立即登录</button>
        <button wx:else class="but" type="primary" open-type="getUserInfo" lang="zh_CN" bindgetuserinfo="bindgetuserinfo">立即登录</button>
      </view>
    </view>
    <view class="mask"></view>
  </view>
</view>

