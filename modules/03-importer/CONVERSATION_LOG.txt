模块：03-importer
窗口负责人：
开始时间：

【记录规则】
1) 只记录与本模块有关的对话与决定（不要粘贴敏感信息：账号/密码/密钥）。
2) 每次对话后追加一段，格式如下。

--- 2026-01-20 12:00 ---
用户：
助手：
决定/结论：
下一步：


--- 2026-01-21 01:17 ---
决定/结论：完成 AUTOPILOT M1 的 IR + txt parser + 错误报告格式（schema）。
验收路径：
- 运行：node modules/03-importer/tools/parse-txt.mjs modules/03-importer/samples/txt/basic.txt --category "数学/一年级" > modules/03-importer/output/basic.parsed.json
- 查看：modules/03-importer/output/basic.parsed.json
- IR schema：modules/03-importer/ir/question-ir.schema.json
- 错误报告 schema：modules/03-importer/ir/error-report.schema.json

--- 2026-01-21 01:18 ---
决定/结论：完成 AUTOPILOT M2 的导入任务模型（占位）schema。
验收路径：
- 查看：modules/03-importer/ir/import-task.schema.json

--- 2026-01-21 14:44 ---
决定/结论：完成上传/状态接口契约草案（OpenAPI），用于后续服务端实现与联调对齐。
验收路径：
- 查看：modules/03-importer/api/import.openapi.yaml
- 检查包含路径：/import/upload 与 /import/status

--- 2026-01-21 15:24 ---
决定/结论：完成目录层级解析最小实现（支持根目录折叠、过滤垃圾文件、根目录文件归入“未分类”）。
验收路径：
- 运行：node modules/03-importer/tools/parse-hierarchy.mjs modules/03-importer/samples/hierarchy/file-list.txt > modules/03-importer/output/hierarchy.json
- 查看：modules/03-importer/output/hierarchy.json

--- 2026-01-21 16:12 ---
决定/结论：完成 doc/docx 最小解析（docx 解压提取文本 → 复用 txt parser 产出 IR JSON）。
验收路径：
- 运行：pwsh -File modules/03-importer/tools/parse-docx.ps1 modules/03-importer/samples/docx/basic.docx -Category "示例题库" > modules/03-importer/output/basic.docx.parsed.json
- 查看：modules/03-importer/output/basic.docx.parsed.json

--- 2026-01-21 16:27 ---
决定/结论：完成 pdf 最小解析（受限：仅支持未压缩文本流，用于 MVP 验证链路）。
验收路径：
- 运行：node modules/03-importer/tools/parse-pdf.mjs modules/03-importer/samples/pdf/basic.pdf --category "示例题库" > modules/03-importer/output/basic.pdf.parsed.json
- 查看：modules/03-importer/output/basic.pdf.parsed.json

--- 2026-01-21 17:31 ---
决定/结论：完成图片 OCR 的“人工校对流程”最小实现（生成待录入的题目 IR 占位 + OCR_PENDING 错误项）。
验收路径：
- 运行：node modules/03-importer/tools/prepare-ocr-review.mjs modules/03-importer/samples/ocr/image-list.txt --category "示例题库" > modules/03-importer/output/ocr.review.json
- 查看：modules/03-importer/output/ocr.review.json

--- 2026-01-21 ---
分支：feat/03-importer-mvp-w03
验收：
- node modules/03-importer/tools/prepare-ocr-review.mjs modules/03-importer/samples/ocr/image-list.txt --category "示例题库" > modules/03-importer/output/ocr.review.json
- 查看 modules/03-importer/output/ocr.review.json
变更点：
- 新增 OCR 人工校对包生成工具（输出 IR 占位 + OCR_PENDING 错误项）
- 补充 OCR 样例输入与输出（image-list.txt/blank.png/ocr.review.json）

--- 2026-01-21 ---
分支：feat/03-importer-preview-w03-v1
验收：
- node modules/03-importer/tools/parse-txt.mjs modules/03-importer/samples/txt/basic.txt --category "数学/一年级" --out modules/03-importer/output/basic.parsed.json
- node modules/03-importer/tools/preview-ir.mjs modules/03-importer/output/basic.parsed.json --limit 2 --out modules/03-importer/output/preview.basic.json
变更点：
- parse-txt 支持 --out，避免 PowerShell 重定向导致的编码/JSON 损坏
- 新增 preview-ir 工具：从已解析 IR 预览前 N 道题并支持 --out

--- 2026-01-21 ---
分支：feat/03-importer-import-local-w03-v1
验收：
- pwsh -NoProfile -File modules/03-importer/tools/import-local.ps1 modules/03-importer/samples/import-local/basic.zip -OutDir modules/03-importer/output/import-local/basic -CategoryPrefix "示例题库"
- 查看 modules/03-importer/output/import-local/basic/import-task.json
- 查看 modules/03-importer/output/import-local/basic/questions.json
变更点：
- 新增本地导入串联工具 import-local：zip 解包→（根目录折叠）→按目录生成 categoryPath→复用 txt parser→产出 import-task+questions+mapping
- 提供可复现样例 zip 与输出（samples/import-local + output/import-local）

--- 2026-01-21 ---
分支：feat/03-importer-keywords-w03-v1
验收：
- node modules/03-importer/tools/show-keywords.mjs --out modules/03-importer/output/keywords.json
- 查看 modules/03-importer/output/keywords.json
变更点：
- 新增关键词提取工具 show-keywords：从 TASKS.md 提取本模块关键词，便于按关键词执行
- 修复本分支误操作：已将 TASKS.md 恢复为 origin/main 内容（仅新增工具与输出）

--- 2026-01-21 ---
分支：feat/03-importer-gitignore-w03-v1
验收：
- 查看 modules/03-importer/.gitignore
- （可选）在 modules/03-importer/output/<any>/unpacked/ 生成文件后执行 git status，应不出现该目录
变更点：
- 新增模块级 .gitignore：忽略导入过程产生的 unpacked/ 与临时 JSON，避免误提交大目录

--- 2026-01-21 ---
分支：feat/03-importer-validate-task-w03-v1
验收：
- node modules/03-importer/tools/validate-import-task.mjs modules/03-importer/output/import-task.sample.json --out modules/03-importer/output/import-task.sample.validation.json
- 查看 modules/03-importer/output/import-task.sample.validation.json
变更点：
- 新增导入任务校验工具 validate-import-task：校验 Import Task JSON（状态/进度/统计/错误项）
- 补充 import-task.sample.json 与校验输出样例，便于对齐 schema 与联调

--- 2026-01-21 ---
分支：feat/03-importer-hierarchy-out-w03-v1
验收：
- node modules/03-importer/tools/parse-hierarchy.mjs modules/03-importer/samples/hierarchy/file-list.txt --out modules/03-importer/output/hierarchy.json
- 查看 modules/03-importer/output/hierarchy.json
变更点：
- parse-hierarchy 支持 --out，避免 PowerShell 重定向导致的编码问题
- 重新生成 hierarchy.json 样例输出（UTF-8，可正确显示中文）

--- 2026-01-21 ---
分支：feat/03-importer-validate-ir-w03-v2
验收：
- node modules/03-importer/tools/parse-txt.mjs modules/03-importer/samples/txt/basic.txt --category "数学/一年级" --out modules/03-importer/output/basic.parsed.json
- node modules/03-importer/tools/validate-ir.mjs modules/03-importer/output/basic.parsed.json --out modules/03-importer/output/basic.parsed.validation.json
- 查看 modules/03-importer/output/basic.parsed.validation.json
变更点：
- 新增题目 IR 校验工具 validate-ir（兼容 PS 重定向 UTF-16），用于快速发现解析结果不符合 IR 的问题
- 补充 basic.parsed 的校验输出样例

--- 2026-01-21 ---
分支：feat/03-importer-pdf-out-w03-v1
验收：
- node modules/03-importer/tools/parse-pdf.mjs modules/03-importer/samples/pdf/basic.pdf --category "示例题库" --out modules/03-importer/output/basic.pdf.parsed.json
- 查看 modules/03-importer/output/basic.pdf.parsed.json
变更点：
- parse-pdf 支持 --out（UTF-8 写文件），避免 PowerShell 重定向编码问题
- 修正 pdf 解析错误项的 filePath 指向源 PDF（不再指向临时 txt 路径）

--- 2026-01-21 ---
分支：feat/03-importer-docx-out-w03-v1
验收：
- pwsh -NoProfile -File modules/03-importer/tools/parse-docx.ps1 modules/03-importer/samples/docx/basic.docx -Category "示例题库" -SourcePath "modules/03-importer/samples/docx/basic.docx" -OutJson modules/03-importer/output/basic.docx.parsed.json
- 查看 modules/03-importer/output/basic.docx.parsed.json
变更点：
- parse-docx 支持 -OutJson（UTF-8 写文件），避免 PowerShell 重定向编码问题
- 解析结果 file.path 固定为源 docx 路径（不再指向临时 extracted.txt）

--- 2026-01-21 ---
分支：feat/03-importer-run-samples-w03-v1
验收：
- pwsh -NoProfile -File modules/03-importer/tools/run-samples.ps1
变更点：
- 新增 run-samples 脚本：一键跑通本模块所有样例链路（txt/preview/hierarchy/pdf/ocr/docx + 校验），输出写入临时目录

--- 2026-01-21 ---
分支：feat/03-importer-hash-w03-v2
验收：
- node modules/03-importer/tools/hash-import.mjs --root modules/03-importer/samples/import-local/basic_src --out modules/03-importer/output/import-local.basic.hash.json
- 查看 modules/03-importer/output/import-local.basic.hash.json
变更点：
- 新增 hash-import 工具：对导入文件夹计算稳定 SHA256（可用于后续幂等/去重 key）
- 补充 hash 样例输出文件

--- 2026-01-21 ---
分支：feat/03-importer-manifest-w03-v2
验收：
- node modules/03-importer/tools/make-import-manifest.mjs --root modules/03-importer/samples/import-local/basic_src --source modules/03-importer/samples/import-local/basic.zip --out modules/03-importer/output/import-manifest.sample.json
- 查看 modules/03-importer/output/import-manifest.sample.json
变更点：
- 新增 make-import-manifest：基于 hash-import 生成 importHash + files 清单，供后续幂等/去重使用
- 补充导入清单样例输出文件

--- 2026-01-21 ---
分支：feat/03-importer-log-helper-w03-v1
验收：
- pwsh -NoProfile -File modules/03-importer/tools/append-conversation-log.ps1 -Branch feat/03-importer-log-helper-w03-v1 -Date 2026-01-21 -Acceptance @('ok') -Changes @('ok')
变更点：
- 新增 append-conversation-log：按标准区块追加到 CONVERSATION_LOG.txt

--- 2026-01-21 ---
分支：feat/03-importer-unpack-zip-w03-v1
验收：
- pwsh -NoProfile -File modules/03-importer/tools/unpack-zip.ps1 modules/03-importer/samples/import-local/basic.zip -OutDir modules/03-importer/output/_unpack_tmp -FileListOut modules/03-importer/output/basic.zip.file-list.txt
- 查看 modules/03-importer/output/basic.zip.file-list.txt
变更点：
- 新增 unpack-zip：zip 解包并输出 file-list.txt（UTF-8，无 BOM）
- 补充 basic.zip.file-list.txt 样例输出

--- 2026-01-21 ---
分支：feat/03-importer-log-helper-w03-v3
验收：
- pwsh -NoProfile -File modules/03-importer/tools/append-conversation-log.ps1 -Branch feat/03-importer-log-helper-w03-v3 -Date 2026-01-21 -AcceptanceFile <utf8.txt> -ChangesFile <utf8.txt>
变更点：
- append-conversation-log 支持 -AcceptanceFile/-ChangesFile，减少命令行转义/数组传参错误

--- 2026-01-21 ---
分支：feat/03-importer-validate-manifest-w03-v1
验收：
- node modules/03-importer/tools/validate-import-manifest.mjs modules/03-importer/output/import-manifest.sample.json --out modules/03-importer/output/import-manifest.sample.validation.json
- 查看 modules/03-importer/output/import-manifest.sample.validation.json
变更点：
- 新增 validate-import-manifest：校验导入清单格式（schema/importHash/files/fileCount），失败返回非 0
- 补充 import-manifest.sample 的校验输出样例
