openapi: 3.0.3
info:
  title: 03-importer Import API (Draft)
  version: 0.1.0
  description: |
    Draft API contract for the importer module.
    This file is used for alignment; final contract is owned by 99-hub.
servers:
  - url: /api
paths:
  /import/upload:
    post:
      summary: Upload and create an import task
      description: Upload a zip file or multiple files to start an import task.
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [files]
              properties:
                files:
                  type: array
                  items:
                    type: string
                    format: binary
                mode:
                  type: string
                  description: Optional hint for server-side handling.
                  enum: [zip, multi-file]
                options:
                  type: string
                  description: Optional JSON string for advanced options (e.g. {"dryRun":true}).
      responses:
        "202":
          description: Task created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ImportTask"
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "413":
          description: Payload too large
        "415":
          description: Unsupported media type
  /import/status:
    get:
      summary: Get import task status
      parameters:
        - in: query
          name: id
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Current task state
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ImportTask"
        "404":
          description: Not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
components:
  schemas:
    ImportTask:
      type: object
      required: [id, status, progress]
      properties:
        id:
          type: string
        status:
          type: string
          enum: [queued, running, done, failed]
        progress:
          type: integer
          minimum: 0
          maximum: 100
        stage:
          type: string
        createdAt:
          type: string
        updatedAt:
          type: string
        result:
          type: object
          additionalProperties: false
          properties:
            parsedCount: { type: integer, minimum: 0 }
            importedCount: { type: integer, minimum: 0 }
            skippedCount: { type: integer, minimum: 0 }
            errorCount: { type: integer, minimum: 0 }
        errors:
          type: array
          items:
            type: object
            additionalProperties: false
            required: [code, message]
            properties:
              code: { type: string }
              message: { type: string }
              file: { type: string }
              line: { type: integer, minimum: 1 }
    ErrorResponse:
      type: object
      additionalProperties: false
      required: [error]
      properties:
        error:
          type: string
        message:
          type: string
