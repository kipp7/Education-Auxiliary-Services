模块：02-backend-core
窗口负责人：
开始时间：

【记录规则】
1) 只记录与本模块有关的对话与决定（不要粘贴敏感信息：账号/密码/密钥）。
2) 每次对话后追加一段，格式如下。

--- 2026-01-20 12:00 ---
用户：
助手：
决定/结论：
下一步：

--- 2026-01-21 ---
分支：feat/02-backend-core-error-codes-doc-codex
验收：
- 查看：modules/02-backend-core/ERROR_CODES.md
- 验证任一错误响应含 requestId：cd modules/02-backend-core && npm run dev；curl.exe http://localhost:3000/subjects
变更点：
- 新增错误码草案文档：ERROR_CODES.md
- 说明错误响应格式与常见场景

--- 2026-01-21 ---
分支：feat/02-backend-core-environment-doc-codex
验收：
- 查看：modules/02-backend-core/ENVIRONMENT.md
- 启动：cd modules/02-backend-core && npm run dev
变更点：
- 新增本模块环境变量说明：ENVIRONMENT.md（目前仅 PORT）
- 给出最小验收命令与端口说明


--- 2026-01-21 01:10 ---
里程碑：M1 契约定稿草案（OpenAPI）
验收方式（路径）：
- 查看契约文件：modules/02-backend-core/contract/mvp.openapi.yaml
- 关键接口 smoke（示例 curl，仅用于验收路径记录；服务端实现将在 M2 提供 mock）：
  - curl -X POST http://localhost:3000/auth/wechat -H "Content-Type: application/json" -d '{"code":"demo"}'
  - curl http://localhost:3000/subjects -H "Authorization: Bearer demo"

--- 2026-01-21 01:12 ---
里程碑：M2 最小服务骨架（mock）
验收方式（路径）：
- 启动：在 modules/02-backend-core 目录执行 `npm run dev`（需要本机已安装 Node/npm）
- 健康检查：curl http://localhost:3000/health
- 登录获取 token：curl -X POST http://localhost:3000/auth/wechat -H "Content-Type: application/json" -d '{"code":"demo"}'
- 带 token 访问：curl http://localhost:3000/subjects -H "Authorization: Bearer demo-token"

--- 2026-01-21 14:41 ---
里程碑：M3 端到端 Mock API（可被小程序调用）
验收方式（路径）：
- 启动：cd modules/02-backend-core && npm run dev
- 证据日志：modules/02-backend-core/logs/m3-curl.txt
- 关键接口：/subjects /packages /chapters /questions /answers/submit /videos /videos/progress /activation/redeem /me/entitlements /me/learning-records

--- 2026-01-21 15:27 ---
里程碑：M3 端到端 Mock API（扩展：资讯/套餐）
验收方式（路径）：
- 启动：cd modules/02-backend-core && npm run dev
- 证据日志：modules/02-backend-core/logs/m3-curl.txt
- 新增接口：/content/banners /content/news /content/news/:id /content/recommendations /billing/plans

--- 2026-01-21 16:11 ---
里程碑：M4 联动验收记录（无 MCP 版）
验收方式（路径）：
- 查看/填写：modules/02-backend-core/logs/m4-miniapp-checklist.md

--- 2026-01-21 16:33 ---
里程碑：M5 一键生成证据日志
验收方式（路径）：
- 运行脚本：powershell -ExecutionPolicy Bypass -File modules/02-backend-core/scripts/gen-evidence.ps1
- 产出文件：modules/02-backend-core/logs/m5-evidence.txt

--- 2026-01-21 16:55 ---
里程碑：M6 补齐 MVP 扩展接口（进度/错题/收藏）
验收方式（路径）：
- 启动：cd modules/02-backend-core && npm run dev
- 新增接口：/progress /wrongs /favorites (POST/DELETE)
- 一键证据：powershell -ExecutionPolicy Bypass -File modules/02-backend-core/scripts/gen-evidence-m6.ps1
- 产出文件：modules/02-backend-core/logs/m6-evidence.txt
下一步：请 99-hub 确认契约中 /progress /wrongs /favorites 的字段与错误码枚举（contract/mvp.openapi.yaml）。

--- 2026-01-21 17:05 ---
决定/共识确认：以 `main` 上 `modules/99-hub/REQUESTS.md` 为合并队列准入；本窗口后续不再直接修改 `modules/99-hub/*`，仅向 99-hub 提交分支名 + 验收方式。
下一步：将 `feat/02-backend-core-autopilot-codex` 的验收命令/证据路径发给 99-hub，等待其写入 `modules/99-hub/REQUESTS.md` 入队。

--- 2026-01-21 17:42 ---
里程碑：M7 补齐商业化下单接口（mock）
验收方式（路径）：
- 启动：cd modules/02-backend-core && npm run dev
- 新增接口：POST /billing/order（配合 GET /billing/plans）
- 一键证据：powershell -ExecutionPolicy Bypass -File modules/02-backend-core/scripts/gen-evidence-m7.ps1
- 产出文件：modules/02-backend-core/logs/m7-evidence.txt
下一步：把 `feat/02-backend-core-autopilot-codex` 的 M7 验收方式/证据路径发给 99-hub 入队。

--- 2026-01-21 ---
分支：feat/02-backend-core-autopilot-codex
验收：
- cd modules/02-backend-core && npm run dev
- powershell -ExecutionPolicy Bypass -File modules/02-backend-core/scripts/gen-evidence-m7.ps1
变更点：
- 增加 mock 接口：POST /billing/order（创建订单）
- 更新 OpenAPI 草案：新增 /billing/order 契约与证据输出（logs/m7-evidence.txt）

--- 2026-01-21 ---
分支：feat/02-backend-core-billing-order-query-codex
验收：
- cd modules/02-backend-core && npm run dev
- powershell -ExecutionPolicy Bypass -File modules/02-backend-core/scripts/gen-evidence-m8.ps1
变更点：
- 预留订单查询：GET /billing/order/{orderId}（mock，需 Authorization）
- 预留支付回调：POST /billing/payment/callback（mock，无需 Authorization，更新订单状态）

--- 2026-01-21 ---
分支：feat/02-backend-core-requestid-jsonerr-codex
验收：
- cd modules/02-backend-core && npm run dev
- powershell -ExecutionPolicy Bypass -File modules/02-backend-core/scripts/gen-evidence-m9.ps1
变更点：
- 所有响应新增 `X-Request-Id`，错误体回传 requestId 便于定位
- 非法 JSON 统一返回 400（code=INVALID_ARGUMENT, message=Invalid JSON）

--- 2026-01-21 ---
分支：feat/02-backend-core-cors-delete-codex
验收：
- cd modules/02-backend-core && npm run dev
- powershell -ExecutionPolicy Bypass -File modules/02-backend-core/scripts/gen-evidence-m12.ps1
变更点：
- CORS 允许 `DELETE`：`Access-Control-Allow-Methods` 增加 `DELETE`
- 新增证据脚本与日志：scripts/gen-evidence-m12.ps1、logs/m12-evidence.txt

--- 2026-01-21 ---
分支：feat/02-backend-core-api-endpoints-doc-codex
验收：
- 查看：modules/02-backend-core/API_ENDPOINTS.md
- 对照：modules/02-backend-core/contract/mvp.openapi.yaml
变更点：
- 新增接口清单文档：API_ENDPOINTS.md（用于联调快速查阅）
- 汇总各接口鉴权要求与用途

--- 2026-01-21 ---
分支：feat/02-backend-core-env-example-codex
验收：
- 查看：modules/02-backend-core/.env.example
- 查看：modules/02-backend-core/ENVIRONMENT.md
变更点：
- 新增环境变量模板：.env.example（仅 PORT）
- 在 ENVIRONMENT.md 补充模板入口
